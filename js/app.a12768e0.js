(function(e){function t(t){for(var n,a,i=t[0],u=t[1],l=t[2],f=0,d=[];f<i.length;f++)a=i[f],o[a]&&d.push(o[a][0]),o[a]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);c&&c(t);while(d.length)d.shift()();return s.push.apply(s,l||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,i=1;i<r.length;i++){var u=r[i];0!==o[u]&&(n=!1)}n&&(s.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},o={app:0},s=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/philadelphia-crash-reporter/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var c=u;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var n=r("64a9"),o=r.n(n);o.a},"56d7":function(e,t,r){"use strict";r.r(t);r("cadf"),r("551c"),r("f751"),r("097d");var n=r("2b0e"),o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:""}},[r("b-row",[r("b-col",{attrs:{id:"sidebar",cols:"4"}},[r("p",{attrs:{id:"text"}},[e._v(" Sidebar Crash Analysis Here ")])]),r("b-col",[r("Map")],1)],1)],1)},s=[],a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"map"}})},i=[],u=(r("ac6a"),r("6b54"),r("e192")),l=r.n(u);r("bc3a");l.a.accessToken="pk.eyJ1IjoiYWtzaGF5N2luMiIsImEiOiJjam1xY3dwd24xb2w0M3BtajloNm01ZnZ1In0.lN36aIIC81PO2KGqyaoB-A";var c,f,d,p={x:0,y:0},y=[0],m="https://phl.carto.com/api/v2/sql?q=select%20json_build_object(%27type%27,%20%27FeatureCollection%27,%27features%27,%20json_agg(json_build_object(%27type%27,%20%27Feature%27,%20%27properties%27,%20json_build_object(%27crn%27,crn,%27year%27,crash_year,%27maxSeverity%27,max_severity_level)%20,%27geometry%27%20,%20ST_AsGeoJSON(the_geom)::json)))%20AS%20crashdata%20FROM%20crash_data_collision_crash_2013_2017_vz",h={name:"Map",methods:{initMap:function(){var e=new l.a.Map({container:"map",style:"mapbox://styles/mapbox/light-v10",center:[-75.1652,39.9636],zoom:16});e.on("load",function(){e.addSource("streets",{type:"geojson",data:"https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/Street_Centerline/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=%7B+%22x%22%3A+%22-75.1652%22+%2C%22y%22%3A+%2239.9636%22%7D&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&resultType=standard&distance=1500&units=esriSRUnit_Meter&returnGeodetic=true&outFields=SEG_ID%2C+ST_NAME&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),e.addLayer({id:"streets-visible",type:"line",source:"streets",layout:{},paint:{"line-width":10,"line-color":"#FFB800","line-opacity":.2}}),e.addSource("streets-selected",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),e.addLayer({id:"streets-selected",type:"line",source:"streets-selected",layout:{},paint:{"line-width":6,"line-color":"#FF5714","line-opacity":.6}}),e.addSource("crashes",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),e.addLayer({id:"crashes-selected",type:"circle",source:"crashes",paint:{"circle-radius":["match",["get","maxSeverity"],0,8,1,21,2,12,3,12,4,12,8,8,9,8,6],"circle-color":["match",["get","maxSeverity"],0,"#BFCBC2",1,"#FF0000",2,"#FF7F11",3,"#FF7F11",4,"#FF5666",8,"#BFCBC2",9,"#BFCBC2","#000"],"circle-opacity":.9,"circle-stroke-color":"#fff","circle-stroke-opacity":1,"circle-stroke-width":1.1}})}),e.on("dragend",function(){p.x=e.getCenter().lng,p.y=e.getCenter().lat;var t="https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/Street_Centerline/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=%7B+%22x%22%3A+%22"+p.x.toString()+"%22+%2C%22y%22%3A+%22"+p.y.toString()+"%22%7D&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&resultType=standard&distance=2000&units=esriSRUnit_Meter&returnGeodetic=true&outFields=SEG_ID%2C+ST_NAME&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token=";fetch(t).then(function(e){return e.json()}).then(function(t){e.getSource("streets").setData(t)})}),e.on("click",function(t){var r=[[t.point.x-12,t.point.y-12],[t.point.x+12,t.point.y+12]],n=e.queryRenderedFeatures(r,{layers:["streets-visible"]});n.forEach(function(e){var t=e.properties.SEG_ID;if(-1===y.indexOf(t))y.push(t);else{var r=y.indexOf(t);y.splice(r,1)}}),fetch(m).then(function(e){return e.json()}).then(function(e){return f=e.rows[0].crashdata,f}),fetch("https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/Street_Centerline/FeatureServer/0/query?where=SEG_ID+IN+"+encodeURI("("+y.toString()+")")+"&objectIds=&time=&geometry=&geometryType=esriGeometryPoint&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=&units=esriSRUnit_Kilometer&returnGeodetic=true&outFields=SEG_ID%2C+STNAME&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=none&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=false&quantizationParameters=&sqlFormat=none&f=pgeojson&token=").then(function(e){return e.json()}).then(function(t){return e.getSource("streets-selected").setData(t),c=turf.buffer(t,.01),c}).then(function(){d=turf.pointsWithinPolygon(f,c),e.getSource("crashes").setData(d),console.log(d)})})}},mounted:function(){this.initMap()}},g=h,S=r("2877"),v=Object(S["a"])(g,a,i,!1,null,null,null),b=v.exports,F=r("5f5b");r("f9e3"),r("2dd8");n["default"].use(F["a"]);var _={name:"app",components:{Map:b}},j=_,O=(r("034f"),Object(S["a"])(j,o,s,!1,null,null,null)),x=O.exports;n["default"].config.productionTip=!1,new n["default"]({render:function(e){return e(x)}}).$mount("#app")},"64a9":function(e,t,r){}});
//# sourceMappingURL=app.a12768e0.js.map