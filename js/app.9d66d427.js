(function(e){function t(t){for(var n,s,i=t[0],u=t[1],l=t[2],p=0,d=[];p<i.length;p++)s=i[p],o[s]&&d.push(o[s][0]),o[s]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);c&&c(t);while(d.length)d.shift()();return a.push.apply(a,l||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,i=1;i<r.length;i++){var u=r[i];0!==o[u]&&(n=!1)}n&&(a.splice(t--,1),e=s(s.s=r[0]))}return e}var n={},o={app:0},a=[];function s(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=n,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/philadelphia-crash-reporter/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var c=u;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var n=r("64a9"),o=r.n(n);o.a},"2dae":function(e,t,r){"use strict";var n=r("dc9f"),o=r.n(n);o.a},5094:function(e,t,r){"use strict";var n=r("a794"),o=r.n(n);o.a},"56d7":function(e,t,r){"use strict";r.r(t);r("cadf"),r("551c"),r("f751"),r("097d");var n=r("2b0e"),o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"primary"}},[r("b-navbar-brand",{attrs:{href:"#"}},[e._v("PHILADELPHIA CRASH DATA EXPLORER")])],1),r("b-container",{attrs:{fluid:""}},[r("b-row",[r("b-col",{attrs:{id:"sidebar",cols:"5"}},[r("Sidebar",{attrs:{rows_01:e.dataforTable_01}})],1),r("b-col",[r("Map",{on:{sendvalue:e.updatemessage}})],1)],1)],1)],1)},a=[],s=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},i=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{attrs:{id:"map"}})])}],u=(r("c5f6"),r("ac6a"),r("6b54"),r("e192")),l=r.n(u);r("2ef0");l.a.accessToken="pk.eyJ1IjoiYWtzaGF5N2luMiIsImEiOiJjam1xY3dwd24xb2w0M3BtajloNm01ZnZ1In0.lN36aIIC81PO2KGqyaoB-A";var c,p,d,f={x:0,y:0},y=[0],h=[],m=String,g=String,v={name:"Map",data:function(){return{selectedCrashData:""}},methods:{initmap:function(){var e=this,t=new l.a.Map({container:"map",style:"mapbox://styles/mapbox/light-v10",center:[-75.1652,39.9636],zoom:16,minZoom:15});t.on("load",function(){m=[t.getBounds()._sw.lng-.001,t.getBounds()._sw.lat-.001,t.getBounds()._ne.lng+.001,t.getBounds()._ne.lat+.001].toString(),t.addSource("streets",{type:"geojson",data:"https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/Street_Centerline/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=%7B+%22x%22%3A+%22-75.1652%22+%2C%22y%22%3A+%2239.9636%22%7D&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&resultType=standard&distance=1500&units=esriSRUnit_Meter&returnGeodetic=true&outFields=SEG_ID%2C+ST_NAME&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),t.addLayer({id:"streets-visible",type:"line",source:"streets",layout:{},paint:{"line-width":10,"line-color":"#FFB800","line-opacity":.2}}),t.addSource("streets-selected",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"streets-selected",type:"line",source:"streets-selected",layout:{},paint:{"line-width":6,"line-color":"#FF5714","line-opacity":.6}}),t.addSource("crashes",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"crashes-selected",type:"circle",source:"crashes",paint:{"circle-radius":["match",["get","maxSeverity"],0,8,1,21,2,12,3,12,4,12,8,8,9,8,6],"circle-color":["match",["get","maxSeverity"],0,"#BFCBC2",1,"#FF0000",2,"#FF7F11",3,"#FF7F11",4,"#FF5666",8,"#BFCBC2",9,"#BFCBC2","#000"],"circle-opacity":.9,"circle-stroke-color":"#fff","circle-stroke-opacity":1,"circle-stroke-width":1.1}})}),t.on("moveend",function(){f.x=t.getCenter().lng,f.y=t.getCenter().lat;var e="https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/Street_Centerline/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=%7B+%22x%22%3A+%22"+f.x.toString()+"%22+%2C%22y%22%3A+%22"+f.y.toString()+"%22%7D&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&resultType=standard&distance=2000&units=esriSRUnit_Meter&returnGeodetic=true&outFields=SEG_ID%2C+ST_NAME&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token=";fetch(e).then(function(e){return e.json()}).then(function(e){t.getSource("streets").setData(e),m=[t.getBounds()._sw.lng-.001,t.getBounds()._sw.lat-.001,t.getBounds()._ne.lng+.001,t.getBounds()._ne.lat+.001].toString()})});var r=new l.a.Popup({closeButton:!1,closeOnClick:!1});t.on("mouseenter","streets-visible",function(){t.getCanvas().style.cursor="pointer"}),t.on("mouseleave","streets-visible",function(){t.getCanvas().style.cursor=""}),t.on("mouseenter","crashes-selected",function(){t.getCanvas().style.cursor="pointer"}),t.on("mouseleave","crashes-selected",function(){t.getCanvas().style.cursor=""}),t.on("mouseenter","crashes-selected",function(e){t.getCanvas().style.cursor="pointer";var n=e.features[0].geometry.coordinates.slice(),o=e.features[0].properties;r.setLngLat(n).setHTML("Year: "+o.crashYear+"<br> People Killed: "+o.peopleFatalCount).addTo(t)}),t.on("mouseleave","crashes-selected",function(){t.getCanvas().style.cursor="",r.remove()}),t.on("click",function(r){g="https://phl.carto.com/api/v2/sql?q=select%20json_build_object(%27type%27,%20%27FeatureCollection%27,%27features%27,%20json_agg(%20json_build_object(%20%27type%27,%20%27Feature%27,%20%27properties%27,%20json_build_object(%20%27crn%27,crn,%20%27crashYear%27,crash_year,%20%27crashMonth%27,crash_month,%20%27crashDayOfWeek%27,day_of_week,%20%27crashTimeOfDay%27,time_of_day,%20%27crashHourOfDay%27,hour_of_day,%20%27crashCollisionType%27,%20collision_type,%20%27peopleFatalCount%27,%20fatal_count,%20%27peopleMajorInjury%27,%20maj_inj_count,%20%27peopleModerateInjury%27,%20mod_inj_count,%20%27peopleMinorInjury%27,%20min_inj_count,%20%27peopleTotalCount%27,%20person_count,%20%27peopleMotorcycleCount%27,%20motorcycle_count,%20%27peopleBicycleCount%27,%20bicycle_count,%20%27peoplePedestriansCount%27,%20ped_count,%20%27peoplePedestriansFatalCount%27,%20ped_death_count,%20%27peoplePedestriansMajorInjuryCount%27,ped_maj_inj_count,%20%27maxSeverity%27,max_severity_level%20)%20,%20%27geometry%27%20,%20ST_AsGeoJSON(the_geom)::json)))%20AS%20crashdata%20FROM%20(%20SELECT%20*%20FROM%20crash_data_collision_crash_2013_2017_vz%20WHERE%20ST_Intersects(%20the_geom%20,%20ST_MakeEnvelope("+m+")::geography%20%20))%20AS%20x";var n=[[r.point.x-12,r.point.y-12],[r.point.x+12,r.point.y+12]],o=t.queryRenderedFeatures(n,{layers:["streets-visible"]});o.forEach(function(e){var t=e.properties.SEG_ID;if(-1===y.indexOf(t))y.push(t);else{var r=y.indexOf(t);y.splice(r,1)}}),fetch(g).then(function(e){return e.json()}).then(function(e){return c=[],c=e.rows[0].crashdata,c}).then(function(){fetch("https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/Street_Centerline/FeatureServer/0/query?where=SEG_ID+IN+"+encodeURI("("+y.toString()+")")+"&objectIds=&time=&geometry=&geometryType=esriGeometryPoint&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=&units=esriSRUnit_Kilometer&returnGeodetic=true&outFields=SEG_ID%2C+STNAME&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=none&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=false&quantizationParameters=&sqlFormat=none&f=pgeojson&token=").then(function(e){return e.json()}).then(function(e){return t.getSource("streets-selected").setData(e),p=turf.pointsWithinPolygon(c,turf.buffer(e,.01)),t.getSource("crashes").setData(p),p}).then(function(){h=[],p.features.forEach(function(e){h.push(e.properties)})}).then(function(){return d=_(h).groupBy("crashYear").map(function(e,t){return{crashYear:Number(t),crashCount:_.size(e),peopleCount:_.sumBy(e,"peopleTotalCount"),peopleFatalCount:_.sumBy(e,"peopleFatalCount"),peopleMajorInjury:_.sumBy(e,"peopleMajorInjury"),peopleModerateInjury:_.sumBy(e,"peopleModerateInjury"),peopleMinorInjury:_.sumBy(e,"peopleMinorInjury")}}).value(),d}).then(function(){e.selectedCrashData=d})})})}},mounted:function(){this.initmap()},watch:{selectedCrashData:function(){this.$emit("sendvalue",d)},deep:!0}},j=v,C=(r("5094"),r("2877")),b=Object(C["a"])(j,s,i,!1,null,"47a49516",null),S=b.exports,F=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sidebar"},[e._m(0),r("div",{staticClass:"summary-tables"},[r("div",{staticClass:"table-general"},[r("b-table",{attrs:{striped:"",hover:"",items:e.rows_01}})],1)])])},I=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sidebar-header"},[r("a",{attrs:{id:"table-header"}},[e._v("BASIC CRASH REPORT")]),r("br"),r("a",{attrs:{id:"note"}},[e._v("HOW TO USE THIS APPLICATION")]),r("p",{attrs:{id:"note"}},[e._v("Select street segments in the map to populate this report.\n        Click on selected segements to un-select them and remove them from the report.\n        Crash points on the map and reported data in the table will only reflect what is visible on the map.\n        Refresh the page to reset and start fresh.")])])}],M={name:"Sidebar",props:{rows_01:Array},data:function(){return{crashtotals:[]}}},O=M,x=(r("2dae"),Object(C["a"])(O,F,I,!1,null,null,null)),w=x.exports,E=r("5f5b");r("f9e3"),r("2dd8");n["default"].use(E["a"]);var T=[{crashYear:2013,crashCount:0,peopleCount:0,peopleFatalCount:0,peopleMajorInjury:0,peopleModerateInjury:0,peopleMinorInjury:0},{crashYear:2014,crashCount:0,peopleCount:0,peopleFatalCount:0,peopleMajorInjury:0,peopleModerateInjury:0,peopleMinorInjury:0},{crashYear:2015,crashCount:0,peopleCount:0,peopleFatalCount:0,peopleMajorInjury:0,peopleModerateInjury:0,peopleMinorInjury:0},{crashYear:2016,crashCount:0,peopleCount:0,peopleFatalCount:0,peopleMajorInjury:0,peopleModerateInjury:0,peopleMinorInjury:0},{crashYear:2017,crashCount:0,peopleCount:0,peopleFatalCount:0,peopleMajorInjury:0,peopleModerateInjury:0,peopleMinorInjury:0}],B={name:"app",components:{Map:S,Sidebar:w},data:function(){return{dataforTable_01:T}},methods:{updatemessage:function(e){0==e.length?this.dataforTable_01=T:this.dataforTable_01=e}}},P=B,R=(r("034f"),Object(C["a"])(P,o,a,!1,null,null,null)),A=R.exports;n["default"].config.productionTip=!1,new n["default"]({render:function(e){return e(A)}}).$mount("#app")},"64a9":function(e,t,r){},a794:function(e,t,r){},dc9f:function(e,t,r){}});
//# sourceMappingURL=app.9d66d427.js.map