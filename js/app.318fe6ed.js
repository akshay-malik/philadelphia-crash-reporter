(function(e){function t(t){for(var n,i,o=t[0],u=t[1],l=t[2],d=0,f=[];d<o.length;d++)i=o[d],a[i]&&f.push(a[i][0]),a[i]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);c&&c(t);while(f.length)f.shift()();return s.push.apply(s,l||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,o=1;o<r.length;o++){var u=r[o];0!==a[u]&&(n=!1)}n&&(s.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},a={app:0},s=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/philadelphia-crash-reporter/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var c=u;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var n=r("64a9"),a=r.n(n);a.a},"2dae":function(e,t,r){"use strict";var n=r("dc9f"),a=r.n(n);a.a},"56d7":function(e,t,r){"use strict";r.r(t);r("cadf"),r("551c"),r("f751"),r("097d");var n=r("2b0e"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:""}},[r("b-row",[r("b-col",{attrs:{id:"sidebar",cols:"5"}},[r("Sidebar",{attrs:{crashes:e.childData}})],1),r("b-col",[r("Map",{on:{sendvalue:e.updatemessage}})],1)],1)],1)},s=[],i=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},o=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{attrs:{id:"map"}})])}],u=(r("8615"),r("456d"),r("ac6a"),r("6b54"),r("e192")),l=r.n(u);r("2ef0");l.a.accessToken="pk.eyJ1IjoiYWtzaGF5N2luMiIsImEiOiJjam1xY3dwd24xb2w0M3BtajloNm01ZnZ1In0.lN36aIIC81PO2KGqyaoB-A";var c,d,f,p,y,h,m,v={x:0,y:0},b=[0],g="https://phl.carto.com/api/v2/sql?q=select%20json_build_object(%27type%27,%20%27FeatureCollection%27,%27features%27,%20json_agg(json_build_object(%27type%27,%20%27Feature%27,%20%27properties%27,%20json_build_object(%27crn%27,crn,%27year%27,crash_year,%27maxSeverity%27,max_severity_level)%20,%27geometry%27%20,%20ST_AsGeoJSON(the_geom)::json)))%20AS%20crashdata%20FROM%20crash_data_collision_crash_2013_2017_vz",S=[],F={name:"Map",data:function(){return{updatetotal:"test"}},methods:{initmap:function(){var e=this,t=new l.a.Map({container:"map",style:"mapbox://styles/mapbox/light-v10",center:[-75.1652,39.9636],zoom:16});t.on("load",function(){t.addSource("streets",{type:"geojson",data:"https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/Street_Centerline/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=%7B+%22x%22%3A+%22-75.1652%22+%2C%22y%22%3A+%2239.9636%22%7D&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&resultType=standard&distance=1500&units=esriSRUnit_Meter&returnGeodetic=true&outFields=SEG_ID%2C+ST_NAME&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),t.addLayer({id:"streets-visible",type:"line",source:"streets",layout:{},paint:{"line-width":10,"line-color":"#FFB800","line-opacity":.2}}),t.addSource("streets-selected",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"streets-selected",type:"line",source:"streets-selected",layout:{},paint:{"line-width":6,"line-color":"#FF5714","line-opacity":.6}}),t.addSource("crashes",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"crashes-selected",type:"circle",source:"crashes",paint:{"circle-radius":["match",["get","maxSeverity"],0,8,1,21,2,12,3,12,4,12,8,8,9,8,6],"circle-color":["match",["get","maxSeverity"],0,"#BFCBC2",1,"#FF0000",2,"#FF7F11",3,"#FF7F11",4,"#FF5666",8,"#BFCBC2",9,"#BFCBC2","#000"],"circle-opacity":.9,"circle-stroke-color":"#fff","circle-stroke-opacity":1,"circle-stroke-width":1.1}})}),t.on("dragend",function(){v.x=t.getCenter().lng,v.y=t.getCenter().lat;var e="https://services.arcgis.com/fLeGjb7u4uXqeF9q/ArcGIS/rest/services/Street_Centerline/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=%7B+%22x%22%3A+%22"+v.x.toString()+"%22+%2C%22y%22%3A+%22"+v.y.toString()+"%22%7D&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&resultType=standard&distance=2000&units=esriSRUnit_Meter&returnGeodetic=true&outFields=SEG_ID%2C+ST_NAME&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token=";fetch(e).then(function(e){return e.json()}).then(function(e){t.getSource("streets").setData(e)})}),t.on("click",function(r){var n=[[r.point.x-12,r.point.y-12],[r.point.x+12,r.point.y+12]],a=t.queryRenderedFeatures(n,{layers:["streets-visible"]});a.forEach(function(e){var t=e.properties.SEG_ID;if(-1===b.indexOf(t))b.push(t);else{var r=b.indexOf(t);b.splice(r,1)}}),fetch(g).then(function(e){return e.json()}).then(function(e){return c=e.rows[0].crashdata,c}).then(function(r){fetch("https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/Street_Centerline/FeatureServer/0/query?where=SEG_ID+IN+"+encodeURI("("+b.toString()+")")+"&objectIds=&time=&geometry=&geometryType=esriGeometryPoint&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=&units=esriSRUnit_Kilometer&returnGeodetic=true&outFields=SEG_ID%2C+STNAME&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=none&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=false&quantizationParameters=&sqlFormat=none&f=pgeojson&token=").then(function(e){return e.json()}).then(function(e){return t.getSource("streets-selected").setData(e),d=turf.pointsWithinPolygon(r,turf.buffer(e,.01)),t.getSource("crashes").setData(d),d}).then(function(){S=[],d.features.forEach(function(e){S.push(e.properties)})}).then(function(){return p=_.countBy(S,function(e){return e.year}),p}).then(function(){f=[],y=Object.keys(p),h=Object.values(p);var t=function(e){return e.reduce(function(e,t){return e+t},0)};m=t(h),console.log(m),f.push({year:"Total",crashCount:m});for(var r=0;r<y.length;r++)f.push({year:y[r],crashCount:h[r]});e.updatetotal=f})})})}},mounted:function(){this.initmap()},watch:{updatetotal:function(){this.$emit("sendvalue",f)},deep:!0}},j=F,O=r("2877"),C=Object(O["a"])(j,i,o,!1,null,null,null),x=C.exports,I=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sidebar"},[e._m(0),r("div",{staticClass:"summary-tables"},[r("div",{staticClass:"table-general"},[r("b-table",{attrs:{striped:"",hover:"",items:e.crashes,fields:e.totalsbyyearandmaxseverity}})],1),r("div",{staticClass:"table-general"},[r("b-table",{attrs:{striped:"",hover:"",items:e.crashes,fields:e.fields}})],1),r("div",{staticClass:"table-general"},[r("b-table",{attrs:{striped:"",hover:"",items:e.crashes,fields:e.fields}})],1)])])},w=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sidebar-header"},[r("a",[e._v("Standard Crash Report")])])}],E={name:"Sidebar",props:{crashes:Array},data:function(){return{totalsbyyearandmaxseverity:["year","crashCount","fatal crashes","severe-injury crashes","injury crashes","non-injury crashes"],fields:["year","crashCount"]}}},G=E,q=(r("2dae"),Object(O["a"])(G,I,w,!1,null,null,null)),R=q.exports,D=r("5f5b");r("f9e3"),r("2dd8");n["default"].use(D["a"]);var P={name:"app",components:{Map:x,Sidebar:R},data:function(){return{childData:[]}},methods:{updatemessage:function(e){this.childData=e}}},M=P,B=(r("034f"),Object(O["a"])(M,a,s,!1,null,null,null)),T=B.exports;n["default"].config.productionTip=!1,new n["default"]({render:function(e){return e(T)}}).$mount("#app")},"64a9":function(e,t,r){},dc9f:function(e,t,r){}});
//# sourceMappingURL=app.318fe6ed.js.map